<!doctype html>
<link rel="import" href="../polymer/polymer.html">

<script>
	var Polymer = Polymer || {};
	Polymer.CarbonI18nBehaviorLocales = Polymer.CarbonI18nBehaviorLocales || {
		/**
		 * Adds the translations for a locale
		 *
		 * @param {String} localname Name of the element for which the translations
		 *   are registered, e.g. `x-hello`
		 * @param {String} locale Name of the locale for the translations, e.g. `de`
		 * @param {String} translations Translations for the given locale, e.g. { hello: `Hallo` }
		 */
		add: function(localName, locale, translations) {
			this[localName] = this[localName] || {};
			this[localName][locale] = translations;
		}
	};

	/**
	 * Adds internationalization support to an element
	 *
	 * @polymerBehavior Polymer.CarbonI18nBehavior
	 * @demo demo/index.html
	 */
	Polymer.CarbonI18nBehavior = {
		properties: {
			locale: {
				type: String,
				value: 'en',
				observer: '_onChangedLocale'
			},

			/** Exposes all translations */
			i18n: Object
		},

		ready: function() {
			// Trigger initial load
			this._onChangedLocale(this.locale);
		},

		/**
		 * Returns localized text with replaced placeholders
		 *
		 * @param {Object} i18n Polymer data binding requires the parameter
		 *   to trigger a reload whenever the locale changes.
		 * @param {String} key Key under which the translation is stored
		 */
		i18nFormat: function(i18n, key) {
			var args = Array.prototype.slice.call(arguments, 2);
			return this._format(this.i18n[key], args);
		},

		_onChangedLocale: function(locale) {
			this.i18n = Polymer.CarbonI18nBehaviorLocales[this.localName][locale];
		},

		/**
		 * Simple version of formatf
		 */
		_format: function(format, args) {
			return format.replace(/{(\d+)}/g, function(match, number) {
				return typeof args[number] != 'undefined' ? args[number] : match;
			});
		}
	};
</script>
